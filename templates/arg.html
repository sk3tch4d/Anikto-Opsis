<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARG Summary</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/disc/disc.css') }}">
</head>
<body data-page="arg">
  <h2>
    <span id="site-title" class="typed-text gradient-title gradient-shift" data-title="ARG Summary|Anikto Opsis"></span>
  </h2>
  <div id="panel-wrapper">
    {% set shift_icons = {'Day':'â˜€ï¸','Evening':'ğŸŒ‡','Night':'ğŸŒ™'} %}
    {% set reason_icons = {
      'Shift Swap':'ğŸ”„','Sick Leave':'ğŸ©¼','Covering Vacant':'ğŸªª',
      'Schedule Adjustment':'ğŸª›','Vacation':'ğŸŒ´','Stat Holiday':'â­',
      'Leave of Absence':'ğŸª','Other':'â”'
    } %}

    <div id="panel-container">

      <!-- SCHEDULED PANEL -->
      <div class="panel panel-animate" id="arg-date-search-panel">
        <div class="panel-header open" onclick="togglePanel(this)">Scheduled</div>
        <div class="panel-body scrollable-panel open">
          <div class="sticky-bar">
            <div style="display: flex; gap: 0.25rem; margin-bottom: 1rem;">
              <select id="emp-filter" class="input full-width" style="flex: 0 0 90px;">
                <option value="all">All</option>
                <option value="ft">FT</option>
                <option value="pt">PT</option>
              </select>
              <div id="custom-date-display" class="custom-date-display" style="flex: 1;"
                   onclick="document.getElementById('working-date').showPicker()">
                <button id="prev-day" class="date-nav-button inside-left">
                  <span class="arrow-desktop">â†</span><span class="arrow-mobile">&lt;</span>
                </button>
                <span id="custom-date-text">Today</span>
                <button id="next-day" class="date-nav-button inside-right">
                  <span class="arrow-desktop">â†’</span><span class="arrow-mobile">&gt;</span>
                </button>
              </div>
              <input type="date" id="working-date" style="position: absolute; left: -9999px;">
            </div>
          </div>
          <div id="working-date-loading" style="display: none; text-align: center;"></div>
          <div id="working-date-results" style="margin-top: 1em;"></div>
        </div>
      </div>

      <!-- SHIFT LOOKUP PANEL -->
      <div class="panel panel-animate" id="arg-lookup-panel">
        <div class="panel-header" onclick="togglePanel(this)">Shift Lookup</div>
        <div class="panel-body scrollable-panel open">
          <div class="sticky-bar">
            <div style="display: flex; gap: 0.25rem; margin-bottom: 1rem;">
              <select id="lookup-filter" class="input full-width" style="flex: 0 0 92px;">
                <option value="all">All</option>
                <option value="week">Week</option>
                <option value="period">Period</option>
              </select>
              <select id="lookup-select" class="input full-width" style="flex: 1;">
                <option></option>
              </select>
            </div>
          </div>
          <div class="panel-delta" id="lookup-container"></div>
        </div>
      </div>

      <!-- SWAPS & COVERAGE PANEL -->
      <div class="panel panel-animate" id="arg-coverage-panel">
        <div class="panel-header" onclick="togglePanel(this)">Swaps & Coverage (In Dev)</div>
        <div class="panel-body scrollable-panel">
          {% if stats.swaps %}
            {% for swap in stats.swaps %}
              <div class="panel-card">
                <strong>{{ reason_icons.get(swap.reason, 'â”') }} <em>{{ swap.reason }}</em> ({{ swap.shift|replace("d","") }})</strong><br>
                {{ swap.start }} â€“ {{ swap.end }}<br>
                {{ swap.org_employee }} â†’ {{ swap.cov_employee }}<br>
                {{ swap.date }}
              </div>
            {% endfor %}
          {% else %}
            <p>No shift swaps or exceptions detected.</p>
          {% endif %}
        </div>
      </div>

      <!-- STATS & RANKINGS PANEL -->
      <div class="panel panel-animate" id="arg-stat-panel">
        <div class="panel-header open" onclick="togglePanel(this)">Stats & Rankings</div>
        <div class="panel-body scrollable-panel open">
          <div class="sticky-bar">
            <div style="display: flex; gap: 0.25rem; margin-bottom: 1rem;">
              <select id="emp-stats-filter" class="input full-width" style="flex: 0 0 90px;">
                <option value="all">All</option>
                <option value="ft">FT</option>
                <option value="pt">PT</option>
              </select>
              <select id="stats-mode-select" class="input full-width">
                <option value="weekly">Weekly Rankings</option>
                <option value="period">Period Rankings</option>
                <option value="total">Total Rankings</option>
                <option value="stats">Statistics</option>
              </select>
            </div>
          </div>
          <div class="panel-delta" id="stats-container"></div>
        </div>
      </div>

      <!-- SHIFT INFO PANEL (Finalized to Match Scheduled) -->
      <div class="panel panel-animate" id="arg-info-panel">
        <div class="panel-header" onclick="togglePanel(this)">Shift Info (In Development)</div>
        <div class="panel-body scrollable-panel open">
          <div class="sticky-bar">
            <div style="display: flex; gap: 0.25rem; margin-bottom: 1rem;">
              <button id="prev-info" class="date-nav-button inside-left"><span>â–²</span></button>
              <select id="info-select" class="input full-width" style="flex: 1;"></select>
              <button id="next-info" class="date-nav-button inside-right"><span>â–¼</span></button>
            </div>
          </div>
          <div class="panel-delta" id="info-container"></div>
        </div>
      </div>

      <!-- DOWNLOADS PANEL -->
      <div class="panel panel-animate" id="arg-downloads-panel">
        <div class="panel-header" onclick="togglePanel(this)">Downloads</div>
        <div class="panel-body">
          {% if outputs %}
            {% for file in outputs %}
              <a class="button panel" href="{{ url_for('file.download', filename=file) }}" download>
                {% if "ARGX" in file %}Spreadsheet{% elif "ARGM" in file %}Heatmap{% else %}{{ file }}{% endif %}
              </a>
            {% endfor %}
          {% else %}
            <p>No output files were generated.</p>
          {% endif %}
        </div>
      </div>

      <!-- SUBMIT PANEL -->
      <div class="panel panel-animate no-shadow">
        <form action="{{ url_for('index') }}" method="get" class="button-form">
          <button type="submit" class="button full-width">Main Menu</button>
        </form>
      </div>

    </div>
  </div>
  <script type="module" src="{{ url_for('static', filename='js/scripts.js', v=2) }}"></script>
</body>
</html>
